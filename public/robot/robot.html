<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Robot Simulator (WS Signaling + WebRTC Sender)</title>
  <link rel="stylesheet" href="robot.css" />
</head>

<body>
  <h1>Robot Simulator (WebRTC → Unity)</h1>

  <div class="card">
    <div class="row">
      <label>WebSocket:</label>
      <input id="wsUrl" style="flex:1" />

      <label>robotId:</label>
      <input id="robotId" style="width: 160px" value="sim-robot-1"/>

      <label>STUN:</label>
      <input id="stunUrl" style="width: 240px" value="stun:stun.l.google.com:19302"/>

      <label>Streaming mode:</label>
      <select id="mode" style="width: 240px">
        <option value="webcam2d">1) webcam → 2D canvas</option>
        <option value="full360">2) 360 → skybox</option>
        <option value="crop360">3) cropped 360 → sphere (black fill)</option>
      </select>

      <label>Webcam FPS</label>
      <select id="webcamFps" style="width:90px">
        <option value="30">30</option>
        <option value="60">60</option>
      </select>

      <label>Webcam Res</label>
      <select id="webcamRes" style="width:130px" title="Applies live if possible, otherwise press Start/Apply">
        <option value="1920x1080">1920×1080</option>
        <option value="1280x720" selected>1280×720</option>
        <option value="960x540">960×540</option>
        <option value="640x360">640×360</option>
        <option value="320x180">320×180</option>
        <option value="auto">Auto</option>
      </select>

      <label>360 Video:</label>
      <select id="video360Sel" style="width: 240px">
        <option value="360">360.mp4 (1920×1080)</option>
        <option value="360_2">360_2.mp4 (3840×2160)</option>
      </select>

      <label>HFOV (crop):</label>
      <input id="hfov" style="width:90px" value="120"/>

      <label>VFOV (crop):</label>
      <input id="vfov" style="width:90px" value="120"/>
    </div>

    <div class="row">
      <button id="btnConnect">Connect WS</button>
      <button id="btnDisconnect" class="danger" disabled>Disconnect</button>

      <button id="btnStartMedia" class="secondary" disabled>Start / Apply Mode</button>
      <button id="btnStopAll" class="danger" disabled>Stop All</button>
      <span class="small">Tip: change resolution while streaming and watch Unity jitterBufferAvgMs in real time.</span>
    </div>

    <div class="status-bar">
      <span id="wsStatus"><span class="status-dot status-idle"></span>WS: disconnected</span>
      <span id="pcStatus"><span class="status-dot status-idle"></span>WebRTC: idle</span>
      <span id="mediaStatus"><span class="status-dot status-idle"></span>Media: off</span>

      <span id="netRtt">RTT: --</span>
      <span id="netJitter">Jitter: --</span>
      <span id="capRes">Capture: --</span>

      <span id="selStatus"></span>
      <span id="FPS"></span>
    </div>

    <div class="grid">
      <div class="pane">
        <h2>Outgoing preview (what you send)</h2>
        <video id="preview" autoplay muted playsinline></video>
        <div class="logs" id="rawLog"></div>
      </div>

      <div class="pane">
        <h2>Controls received (server → robot)</h2>
        <div class="logs" id="controlsLog"></div>
      </div>

      <div class="pane">
        <h2>Signaling + viewport</h2>
        <div class="logs" id="sigLog"></div>
      </div>
    </div>
  </div>

  <script src="robot.js"></script>
</body>
</html>
